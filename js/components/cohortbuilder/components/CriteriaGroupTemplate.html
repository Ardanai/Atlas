<div class="criteriaGroup">
	<div class="criteriaHeading">
		<table>
			<colgroup>
				<col />
				<col />
			</colgroup>
			<tbody>
				<tr>
					<td>
						<span data-bind="if: parentGroup">
							<span data-bind="	if: (parentGroup().CriteriaList().length > 0) || (parentGroup().DemographicCriteriaList().length > 0) || parentGroup().Groups().indexOf(group()) > 0"><span data-bind="	text: parentGroup().Type() == 'ALL' ? 'And ' : 'Or '"></span>
								<span data-bind="text:ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group.button.having','having')"></span>

							</span>
						<span data-bind="	ifnot: (parentGroup().CriteriaList().length > 0) || (parentGroup().DemographicCriteriaList().length > 0) || parentGroup().Groups().indexOf(group()) > 0">
							<span data-bind="text:ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group.button.having','having')"></span>
						</span>
						</span>
						<span data-bind="ifnot: parentGroup">
							<span data-bind="text: ko.i18n('cc.viewEdit.design.subgroups.new.criteria.condition.start','having')"></span>
						</span>

						<select data-bind="options: $component.options.groupTypeOptions, optionsText: 'name', optionsValue: 'id', value: group().Type"></select>
						<!-- ko if: group().Type().startsWith("AT_") -->
						<span contenteditable="true" class="numericInputField dropdown"
							  data-bind="htmlValue: group().Count.numeric(),
							             eventType:'blur',
							             ko_autocomplete: { value: group().Count, source: $component.groupCountOptions(), minLength: 0, maxShowItems: 10, scroll: true }"
						/>
						<!-- /ko -->
						<span data-bind="text: ko.i18n('cc.viewEdit.design.subgroups.new.criteria.condition.end', 'of the following criteria:')"></span>
					</td>
					<td>
						<drop-down-menu
								data-bind=" attr: { 'title': ko.i18n('cc.viewEdit.design.subgroups.add.drop-down.title', 'Add criteria to group...') }"
								params="actions: $component.addCriteriaActions,
												formatOption: $component.formatOption">

						</drop-down-menu>
					</td>
				</tr>
			</tbody>
		</table>
	</div>

	<div style="min-height: 10px;" data-bind="sortable: {data: group().DemographicCriteriaList, connectClass: 'demographicCriteria', options: {cancel: ':input, button, [contenteditable]'}}">
		<div class="demographicCriteria">
			<table>
				<colgroup>
					<col span="1" class="rule" />
					<col span="1" class="delete" />
				</colgroup>
				<tbody>
					<tr>
						<td>
							<div class="criteria-content">
								<div class="occurrenceSection">
									<span data-bind="if: ($index() > 0)"><span data-bind="text: $component.group().Type() == 'ALL' ? 'and ' : 'or '"></span></span>
									<span data-bind="text:ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group-template.with-the-following-event-criteria', 'with the following event criteria:')"></span>

								</div>
								<div>
									<demographic-criteria params="criteria: $data"></demographic-criteria>
								</div>
							</div>
						</td>
						<td>
							<button class="deletecriteria btn btn-sm btn-danger" data-bind="click: function (data, event) { $component.removeCriteria($parent.group().DemographicCriteriaList, data) }">
								<span data-bind="text:ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group-template.delete', 'Delete Criteria')"></span>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<div style="min-height: 10px;" data-bind="sortable: {data: group().CriteriaList, connectClass: 'additionalCriteria', options: {cancel: ':input, button, [contenteditable]'}}">
		<div class="additionalCriteria">
			<table>
				<colgroup>
					<col span="1" class="rule" />
					<col span="1" class="delete" />
				</colgroup>
				<tbody>
					<tr>
						<td>
							<div class="criteria-content ui-front">
								<div class="occurrenceSection">
									<span data-bind="if: ($parent.group().DemographicCriteriaList().length > 0 || $index() > 0)"><span data-bind="	text: $component.group().Type() == 'ALL' ? 'and ' : 'or '"></span></span>

									<span data-bind="text: ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group.with','with')"></span>
									<select data-bind=" options: $component.options.occurrenceTypeOptions,
														optionsText: 'name',
														optionsValue: 'id',
														value: Occurrence.Type" />
<!--									<select data-bind="options: $component.options.occurrenceCountOptions, value: Occurrence.Count" /> -->
									<span contenteditable="true" class="numericInputField dropdown" 
												data-bind="htmlValue: Occurrence.Count.numeric(), 
																	 eventType: 'blur', 
																	 ko_autocomplete: { value: Occurrence.Count, source: $component.options.occurrenceCountOptions, minLength: 0, maxShowItems: 10, scroll: true }" />									
									<button data-bind="click: function() { Occurrence.IsDistinct(!Occurrence.IsDistinct())},
														text: Occurrence.IsDistinct() ?
															  ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group.using-distinct','using distinct') :
															  ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group.using-all','using all')
									"></button> <span data-bind="text: ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group.occurrences-of','occurrences of:')"></span>
								</div>
								<div data-bind="component: {
									name: $component.getCriteriaComponent($data.Criteria),
									params: {expression: $component.expression, criteria: $data.Criteria }
								}"></div>

								<div class="indexWindowSection">
									<span data-bind="text:ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group-template.where', 'where')"></span>
									<cycle-toggle-input params="{value: StartWindow.UseEventEnd, options: $component.options.EventDateOptions}"></cycle-toggle-input>
									<span data-bind="text:ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group.between','between')"></span><br/>

									<window-input params="Window: StartWindow"></window-input> <cycle-toggle-input params="{value: StartWindow.UseIndexEnd, options: $component.options.IndexDateOptions}"></cycle-toggle-input>
									<!-- ko if: EndWindow -->
									<div>
										<i data-bind="click: $component.removeEndWindow" class="fa fa-times" />
										<span data-bind="text:ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group-template.and', 'and')"></span>

										<cycle-toggle-input params="{value: EndWindow().UseEventEnd, options: $component.options.EventDateOptions}"></cycle-toggle-input>
										<span data-bind="text:ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group-template.between', 'between')"></span>

										<window-input params="Window: EndWindow"></window-input> <cycle-toggle-input params="{value: EndWindow().UseIndexEnd, options: $component.options.IndexDateOptions}"></cycle-toggle-input>
									</div>
									<!-- /ko -->
									<!-- ko ifnot: EndWindow -->
									<span class="linkish" data-bind="click: $component.addEndWindow"><i>
										<span data-bind="text:ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group-template.add additional constraint', 'add additional constraint')"></span>

									</i></span>
									<!-- /ko -->
									<div class="indexMessage"><span class="indexMessage" data-bind="text: $component.indexMessage"></span></div>
								</div>

								<div class="restrictVisitSection" data-bind="if: $component.hasVO($data.Criteria)">
									<input type="checkbox" data-bind="checked: RestrictVisit"> <span data-bind="text:ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group.restrict-to-the-same-visit-occurrence','restrict to the same visit occurrence')"></span><br/>
								</div>
								<input type="checkbox" data-bind="checked: IgnoreObservationPeriod">
								<span data-bind="text:ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group.allow-events-from-outside-observation-period','allow events from outside observation period')"></span><br/>
							</div>
						</td>
						<td>
							<button class="deletecriteria btn btn-sm btn-danger" data-bind="click: function (data, event) { $component.removeCriteria($parent.group().CriteriaList, data) }">
								<span data-bind="text:ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group.button.delete-criteria','Delete Criteria')"></span>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<!-- ko foreach: group().Groups -->
	<div class="critera-group-container" style="position:relative">
		<criteria-group params="{expression: $component.expression,
								group: ko.observable($data),
								parentGroup: $parent.group(),
								indexMessage: $component.indexMessage}"></criteria-group>
		<button class="deletegroup btn btn-sm btn-danger" data-bind="click: function (data, event) { $component.removeCriteria($parent.group().Groups, data) }">

			<span data-bind="text:ko.i18n('cc.viewEdit.design.subgroups.component.criteria-group.button.delete-group','Delete Group')"></span>
		</button>
	</div>
	<!-- /ko -->
</div>
