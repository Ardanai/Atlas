<div class="wrapperHeader">
	<!-- ko if: loading -->
		<div data-bind="css: classes('loading')">
			<i class="fa fa-circle-o-notch fa-spin"></i>
		</div>
	<!-- /ko -->
	<!-- ko ifnot: loading -->
	<!-- for notifications, job completion, etc. -->
	<div class="user-bar-container">
		<select data-bind="css: classes('locale'), foreach:availableLocales, value: locale">
			<option data-bind="value: $data.code, text:$data.name"></option>
		</select>
		<!-- ko if: isLoggedIn -->
		<a data-bind="click: function () { $component.jobModalOpened(true) }"><i data-bind="css: {pending: jobNotificationsPending}" class="fa fa-bell"></i></a>
		<!-- /ko -->
		<div data-bind="if:appConfig.userAuthenticationEnabled===true" style="display: inline-block;">
			<div data-bind="title: ko.i18n('components.userBar.signin', 'Sign In'), if: !isLoggedIn() || tokenExpired()">
				<span class="pipe">|</span><a data-bind="click: function () { $component.signInOpened(true) }"><i class="fa fa-sign-in"></i><span data-bind="text: ko.i18n('components.userBar.signin', 'Sign In')"></span></a>
			</div>
			<div data-bind="title: ko.i18n('components.userBar.signout', 'Sign Out'), if: isLoggedIn() && !tokenExpired()">
				<span class="pipe">|</span><a data-bind="click: function () { $component.signInOpened(true) }"><strong data-bind="text: fullName"></strong><i class="fa fa-user-circle fa-lg" aria-hidden="true"></i></a>
			</div>
		</div>
	</div>
	<!-- /ko -->
</div>

<atlas-modal params="{
		if:appConfig.userAuthenticationEnabled === true,
		showModal: signInOpened,
		modifiers: ['sm'],
		iconClass: 'fa fa-sign-in',
		title: ko.i18n('components.userBar.signin', 'Sign In'),
}">
	<welcome></welcome>
</atlas-modal>

<atlas-modal params="{
		showModal: jobModalOpened,
		title: ko.i18nformat('notifications.title', 'Notifications (last <%=length%>>)', {length: $component.jobListing().length}),
		templateWrapperClass: {},
		data: {
			jobListing: $component.sortedJobListing,
			jobNameClick: $component.jobNameClick,
			jobModalOpened: $component.jobModalOpened,
			toggleCompletedFilter: $component.toggleCompletedFilter,
			hideCompleted: $component.hideCompleted(),
			isRefreshing: $component.isRefreshing(),
			classes: $component.classes
		}
}">
	<div data-bind="css: classes('jobs-modal-content')">
		<div data-bind="if: jobListing().length == 0" style="padding: 5px 10px 0">
			<span data-bind="html: ko.i18n('notifications.explanation', 'Notifications for jobs will be displayed here. A job could include cohort generation, cohort reporting, or other tasks that can take a long time to complete. This top right notification icon will highlight <i class=\'fa fa-bell pending\'></i> if you have new notifications available.')"></span>
		</div>
		<div data-bind="if: jobListing().length > 0">
			<table data-bind="css: classes({ element: 'jobs-table', extra: ['table'] })">
				<thead>
				<th data-bind="text: ko.i18n('notifications.jobName', 'Job Name')"></th>
				<th data-bind="text: ko.i18n('notifications.duration', 'Duration')"></th>
				<th data-bind="text: ko.i18n('notifications.endTime', 'End time')"></th>
				<th data-bind="text: ko.i18n('notifications.status', 'Status')"></th>
				</thead>
				<tbody>
				<!-- ko foreach: jobListing -->
				<tr data-bind="css: { warning: !viewed() }">
					<td data-bind="css: $parent.classes('job-name')">
						<i data-bind="css: $parent.classes({ element: 'job-ico', extra: ['fa fa-tasks'] })"></i> <a data-bind="click: () => { $parent.jobNameClick($data); }, text: $data.name" class="linkish"></a>
					</td>
					<td data-bind="css: $parent.classes('job-duration'), html: duration"></td>
					<td data-bind="css: $parent.classes('job-end'), html: endDate"></td>
					<td data-bind="css: $parent.classes('job-status'), html: status"></td>
				</tr>
				<!-- /ko -->
				<td colspan="4">
					<div class="btn-group pull-right">
						<button type="button" class="btn btn-sm btn-primary" data-bind="click: toggleCompletedFilter">
							<!-- ko if: hideCompleted -->
							<span data-bind="text: ko.i18n('notifications.showCompletedJobsButton', 'Show completed jobs')"></span>
							<!-- /ko -->
							<!-- ko ifnot: hideCompleted -->
							<span data-bind="text: ko.i18n('notifications.hideCompletedJobsButton', 'Hide completed jobs')"></span>
							<!-- /ko -->
							<i data-bind="visible: isRefreshing, css: classes({ element: 'action-ico', extra: ['fa fa-spinner fa-spin']})"></i>
						</button>
					</div>
				</td>
				</tbody>
			</table>
		</div>
	</div>
</atlas-modal>
